function getForm(a){console.log(a);var b=new Object;b.req_merchant_code=a.req_merchant_code,b.req_transaction_id=a.req_transaction_id,b.req_payment_channel=a.req_payment_channel,b.req_chain_merchant=a.req_chain_merchant,b.req_amount=a.req_amount,b.req_currency=a.req_currency,b.req_words=a.req_words,b.req_form_type=a.req_form_type,b.req_domain_valid=document.location.origin,void 0!=a.req_ref_account_id&&""!=a.req_ref_account_id&&(b.req_ref_account_id=a.req_ref_account_id,b.req_access_type="W",b.req_session_id=a.req_session_id),void 0!=a.req_customer_id&&""!=a.req_customer_id&&(b.req_customer_id=a.req_customer_id),void 0!=a.req_token_payment&&""!=a.req_token_payment&&(b.req_token_payment=a.req_token_payment);var c=$("[doku-div='form-payment']").html();doku_timeout=setTimeout(function(){$("[doku-div='form-payment']").html("<br><center><span id='doku-loader-text'>TIMEOUT</span><br><br><a id='doku-retry-button' href='#' onclick='getForm("+JSON.stringify(a)+")'>Try again</a></center><br>"),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"getRequestCode",data:{data:JSON.stringify(b)},dataType:"json",type:"POST",beforeSend:function(){$("[doku-div='form-payment']").html("<br><center><img src='"+loadingUrl+"' class='doku-loader-image'></center><br>")}}).success(function(b){if(console.log(b),clearTimeout(doku_timeout),$("[doku-div='form-payment']").html(c),"0000"==b.res_response_code){if("inline"==a.req_form_type)if(data_obj=$.extend(a,b),void 0==a.req_custom_form)if(void 0!=a.req_mage&&""!=a.req_mage)for(i=0;i<Object.size(b.res_form_payment);i++)$("[doku-div='form-payment']").append(b.res_form_payment[i]);else for(i=0;i<Object.size(b.res_form_payment);i++)$("[doku-div='form-payment']").prepend(b.res_form_payment[i]);else{if("15"==a.req_payment_channel){if(void 0!=a.req_mage&&""!=a.req_mage)for(i=0;i<a.req_custom_form.length;i++)$("#"+a.req_custom_form[i]).append(b.res_form_payment[i]);else for(i=0;i<a.req_custom_form.length;i++)$("#"+a.req_custom_form[i]).prepend(b.res_form_payment[i]);a.req_custom_form.length<5&&(frmSaveToken=b.res_form_payment[4]),"true"==b.res_service_two_click?void 0!=a.req_token_payment&&""!=a.req_token_payment&&void 0!=b.res_tokenization?(tokenization=$.parseJSON(b.res_tokenization),console.log(tokenization),console.log(b.res_form_payment[2]),$("#doku-cc-number").val(tokenization.res_cc_number),$("#doku-cc-number").addClass("readonlycase"),$("#doku-cc-number").prop("disabled","disabled"),$("#doku-cc-number").removeAttr("validation-rules"),$("#"+data_obj.req_custom_form[2]).remove(),$("#"+data_obj.req_custom_form[3]).remove(),$(".doku-cvc").payment("formatCardCVC")):($("[doku-div='form-payment']").append(frmSaveToken),$("[doku-div='form-payment']").after("<br>"),$(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC")):($(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC"))}else{if(void 0!=a.req_mage&&""!=a.req_mage)for(i=0;i<a.req_custom_form.length;i++)$("#"+a.req_custom_form[i]).append(b.res_form_payment[i]);else for(i=0;i<a.req_custom_form.length;i++)$("#"+a.req_custom_form[i]).prepend(b.res_form_payment[i]);if(void 0!=a.req_ref_account_id&&""!=a.req_ref_account_id){var d=$.parseJSON(b.res_data_dw);console.log(d),"0000"==d.responseCode&&($("[doku-div='form-payment']").html(formDw),$("[doku-div='form-payment']").find("img").attr("src",d.avatar),$(".info-dw-user").html(d.customerName+" - "+d.dokuId+"&nbsp;&nbsp;"),$(".info-dw-saldo").html("Rp "+d.listPaymentChannel[0].details.lastBalance.format(0,3,".",",")),void 0!=a.req_wallet_fields&&""!=a.req_wallet_fields&&(void 0!=a.req_wallet_fields.name&&""!=a.req_wallet_fields.name&&$("#"+a.req_wallet_fields.name).val(d.customerName),void 0!=a.req_wallet_fields.phone&&""!=a.req_wallet_fields.phone&&$("#"+a.req_wallet_fields.phone).val(d.customerPhone),void 0!=a.req_wallet_fields.address&&""!=a.req_wallet_fields.address&&$("#"+a.req_wallet_fields.address).val(d.customerAddress),void 0!=a.req_wallet_fields.city&&""!=a.req_wallet_fields.city&&$("#"+a.req_wallet_fields.city).val(d.customerCity),void 0!=a.req_wallet_fields.country&&""!=a.req_wallet_fields.country&&$("#"+a.req_wallet_fields.country).val(d.customerCountry),void 0!=a.req_wallet_fields.email&&""!=a.req_wallet_fields.email&&$("#"+a.req_wallet_fields.email).val(d.customerEmail)))}}btnOnBlur()}else if("full"==a.req_form_type){a=$.extend(a,b),console.log(b.res_form_payment),$("[doku-div='form-payment']").html(b.res_form_payment),$(".amount").text(parseInt(a.req_amount).format(0,3,".",",")),"15"==a.req_payment_channel&&("true"==b.res_service_two_click?void 0!=a.req_token_payment&&""!=a.req_token_payment&&void 0!=b.res_tokenization?(tokenization=$.parseJSON(b.res_tokenization),console.log(tokenization),$("#doku-cc-number").val(tokenization.res_cc_number),$("#doku-cc-number").addClass("readonlycase"),$("#doku-cc-number").prop("disabled","disabled"),$("#doku-cc-number").removeAttr("validation-rules"),$("#doku-li-save-cc").remove(),$("#doku-div-name-cc").remove(),$("#doku-div-cc-exp").remove()):($(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC")):($("#doku-li-save-cc").hide(),$(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC"))),btnOnBlur();var e=$("input[type='button']").map(function(){return this.id}).get();for(i=0;i<e.length;i++)$("#"+e[i]).click(function(){delete a[0],formatForm($.extend($(this).parents("form"),$.extend(a,b)))})}}else $("[doku-div='form-payment']").html("<br><center><span id='doku-loader-text'>Request failed... error code : "+b.res_response_code.replace(new RegExp("_","g")," ")+"</span><br><br><a id='doku-retry-button' href='#' onclick='getForm("+JSON.stringify(a)+")'>Try again</a></center><br>")})}function btnOnBlur(){var a=$("input").not("[type='button']").map(function(){return this.id}).get();for(i=0;i<a.length;i++)$("#"+a[i]).blur(function(){if(void 0!=$(this).attr("validation-rules")){var a=$(this).attr("validation-rules").split("|"),b=new Object;for(j=0;j<a.length;j++){var b=checkRules(this.id,a[j]);if(0==b.status)break}0==b.status?($(this).parent().addClass("has-error"),0==$(this).parent().children("font").length?$(this).parent().append("<font color='red'>"+b.msg+"</font>"):$(this).parent().children("font").html(b.msg)):($(this).parent().removeClass("has-error"),$(this).parent().children("font").remove())}})}function formatForm(a){var b=$("#"+a[0].id+" :input").not("[type='button']").map(function(){return this.id}).get(),c=validateForm(b);if(console.log(c),c){var d=new Object;d.req_input_form=b,d.req_pairing_code=a.res_request_code,d.req_server_url=a.req_server_url,d.req_loading=a.res_form_loading,d.req_result=a.res_form_result,submitForm($.extend(a,d))}}function validateForm(a){var b=!0;for(i=0;i<a.length;i++)if(void 0!=$("#"+a[i]).attr("validation-rules")){var c=$("#"+a[i]).attr("validation-rules").split("|"),d=new Object;for(j=0;j<c.length;j++){var d=checkRules(a[i],c[j]);if(0==d.status)break}0==d.status&&($("#"+a[i]).parent().addClass("has-error"),0==$("#"+a[i]).parent().children("font").length?$("#"+a[i]).parent().append("<font color='red'>"+d.msg+"</font>"):$("#"+a[i]).parent().children("font").html(d.msg),b=!1)}return b}function checkRules(a,b){var c=new Object,d=b;switch(d.indexOf("maxlength")>-1&&(d="maxlength"),d){case"required":""==$("#"+a).val()&&(c.status=!1,c.msg="this field cannot be empty");break;case"maxlength":var e=b.split(":");$("#"+a).val().length>e[1]&&(c.status=!1,c.msg="this field cannot exceed "+e[1]+" characters");break;case"cc":$.payment.validateCardNumber($("#"+a).val())||(c.status=!1,c.msg="The card number is not a valid credit card number.");break;case"cc-cvc":$.payment.validateCardCVC($("#"+a).val())||(c.status=!1,c.msg="The card's security code is invalid.");break;case"cc-exp":if(void 0!=$("#"+a).val()){var f=$("#"+a).val().split(" / ");2==f[1].length&&(f[1]="20"+f[1]),$.payment.validateCardExpiry(f[0],f[1])||(c.status=!1,c.msg="The card's expiration date is invalid.")}break;case"number":1==isNaN($("#"+a).val())&&(c.status=!1,c.msg="Only numbers allowed");break;case"email":var g=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;c.status=g.test($("#"+a).val()),c.msg="Please input your correct email."}return c}function receiveMessage(a){a.origin==originUrl&&(threeDResponse=a.data,$.fancybox.close())}function submitForm(a){var b=processForm(a);$("[doku-div='form-payment']").html(a.req_loading),doku_timeout=setTimeout(function(){a.form_req_result_note="Timeout",showResult(a),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"getToken",data:{data:JSON.stringify(b)},dataType:"json",type:"POST"}).success(function(c){clearTimeout(doku_timeout),console.log("submitForm"),console.log(c),"0000"==c.res_response_code?"04"==a.req_payment_channel?initiateFormWallet($.extend(a,$.extend(b,c))):void 0!=c.res_result_3D?(obj3D=JSON.parse(c.res_result_3D),window.addEventListener("message",receiveMessage,!1),$.fancybox.open([{closeClick:!1,type:"iframe",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:form3D,closeBtn:!1,autoResize:!0,helpers:{overlay:{closeClick:!1}},afterClose:function(){obj3dResponse=$.parseJSON(threeDResponse),"0000"==obj3dResponse.res_response_code?backToMerchant($.extend(a,$.extend(b,c))):(a.form_req_result_note=obj3dResponse.res_response_code,showResult(a))}}]),$("#doku-form-3d").find("#PaReq").val(obj3D.PAREQ),$("#doku-form-3d").find("#MD").val(obj3D.MD),$("#doku-form-3d").find("#TermUrl").val(obj3D.TERMURL),$("#doku-form-3d").attr("action",obj3D.ACSURL),$("#doku-form-3d").submit()):backToMerchant($.extend(a,$.extend(b,c))):(a.form_req_result_note=c.res_response_code,showResult(a))})}function processForm(a){var b=new Object;if(b.req_merchant_code=a.req_merchant_code,b.req_payment_channel=a.req_payment_channel,b.req_transaction_id=a.req_transaction_id,b.req_amount=a.req_amount,b.req_currency=a.req_currency,b.req_pairing_code=a.req_pairing_code,b.req_access_type="W",b.req_domain_valid=document.location.origin,"15"==a.req_payment_channel){if(void 0!=a.req_customer_id&&""!=a.req_customer_id){if(void 0==a.res_tokenization){a.form_req_date=$("#doku-cc-exp").val(),a.form_req_number=$("#doku-cc-number").val();var c=a.form_req_date.split(" / ");2==c[1].length&&(c[1]="20"+c[1]),b.req_date=c[1].substring(2,4)+c[0],b.req_number=a.form_req_number.replace(/ - /g,""),b.req_name=$("#doku-name-cc").val()}1==$("#doku-save-cc").prop("checked")?b.req_save_customer="SAVE":b.req_save_customer="UNSAVE"}else{a.form_req_date=$("#"+a.req_input_form[3]).val(),a.form_req_number=$("#"+a.req_input_form[0]).val();var c=a.form_req_date.split(" / ");2==c[1].length&&(c[1]="20"+c[1]),b.req_date=c[1].substring(2,4)+c[0],b.req_number=a.form_req_number.replace(/ - /g,""),b.req_name=$("#"+a.req_input_form[2]).val()}b.req_secret=$("#doku-cvc").val()}else"04"==a.req_payment_channel&&(b.req_doku_id=$("#"+a.req_input_form[0]).val(),b.req_doku_pass=$("#"+a.req_input_form[1]).val(),b.req_session_id=a.req_session_id,b.req_chain_merchant=a.req_chain_merchant);return b}function backToMerchant(a){console.log("backToMerchant"),console.log(a);var b={doku_token:a.res_token_id,doku_pairing_code:a.req_pairing_code,doku_invoice_no:a.req_transaction_id,doku_amount:a.req_amount,doku_chain_merchant:a.req_chain_merchant,doku_currency:a.req_currency,doku_mall_id:a.req_merchant_code};console.log(a.req_server_url),console.log(b),$.ajax({url:a.req_server_url,data:b,type:"POST"}).success(function(b){console.log(b);var c=JSON.parse(b);"15"==a.req_payment_channel?"0000"!=c.res_response_code?(a.form_req_result_note=c.res_response_code,showResult(a)):1==c.res_show_doku_page?($("[doku-div='form-payment']").html(a.req_result),$(".success").show(),$(".fail").remove(),$("doku-approval-code").html(c.res_approval_code),$("doku-card-number").html(c.res_mcn),$("doku-invoice-number").html(c.res_trans_id_merchant),$("doku-amount").html(c.res_amount),void 0!=c.res_redirect_url?($("div.detail-result").children("a").attr("href","#"),$("div.detail-result").children("a").attr("onclick","window.location = '"+c.res_redirect_url+"';")):$("div.detail-result").children("a").remove()):window.location=c.res_redirect_url:"04"==a.req_payment_channel&&("0000"!=c.res_response_code?(a.form_req_result_note=c.res_response_code,showResult(a)):1==c.res_show_doku_page?($("[doku-div='form-payment']").html(a.req_result),$(".success").show(),$(".fail").remove(),$("doku-approval-code").html(c.res_approval_code),$("doku-invoice-number").html(a.req_transaction_id),void 0!=c.res_card_number?$("doku-card-number").html(c.res_card_number):$("doku-card-number").parent().parent().remove(),void 0!=c.res_promotion&&($("doku-discount").html(parseInt(c.res_promotion.amount).format(0,3,".",",")),parseInt(a.req_amount)-parseInt(c.res_promotion.amount)<0?$("doku-total").html(parseInt(0).format(0,3,".",",")):$("doku-total").html(parseInt(parseInt(a.req_amount)-parseInt(c.res_promotion.amount)).format(0,3,".",",")),$("#doku-discount").show(),$("#doku-total").show()),$("doku-amount").html(parseInt(a.req_amount).format(0,3,".",",")),void 0!=c.res_redirect_url?($("div.detail-result").children("a").attr("href","#"),$("div.detail-result").children("a").attr("onclick","window.location = '"+c.res_redirect_url+"';")):$("div.detail-result").children("a").remove()):window.location=c.res_redirect_url)})}function initiateFormWallet(a){if("0000"==a.res_response_code){$("[doku-div='form-payment']").html(a.res_form_payment_dw),$("#respTabs").responsiveTabs(),$(".resp-tabDrop").wrap("<div class='selectdw'><div class='wrapper-select'></div></div>"),$("input[name$='optdw']").click(function(){var a=$(this).val();$("div.promocontent-dw").hide(),$("#"+a).show()}),$(".amount").text(parseInt(a.req_amount).format(0,3,".",","));JSON.parse(a.res_data_dw);formatWalletCash(a),formatWalletCc(a),btnOnBlur();var c=$("input[type='button']").map(function(){return this.id}).get();for(i=0;i<c.length;i++)$("#"+c[i]).click(function(){delete a[0],formatFormWallet($.extend($(this).parents("form"),a))})}else a.form_req_result_note=a.res_response_code,showResult(a)}function formatWalletCash(a){var b=JSON.parse(a.res_data_dw);if($(".nameuser").text(b.customerName),$(".saldo").text(b.listPaymentChannel[0].details.lastBalance.format(0,3,".",",")),$(".amount-payment").text(parseInt(a.req_amount).format(0,3,".",",")),$(".amount-discount").text(parseInt("0").format(0,3,".",",")),$(".amount-total").text(parseInt(a.req_amount).format(0,3,".",",")),void 0!=b.listPromotion&&b.listPromotion.length>0){for(i=0;i<b.listPromotion.length;i++)$("#doku-voucher").append('<option value="'+b.listPromotion[i].id+'">'+b.listPromotion[i].amount+"</option>");$("#doku-voucher").change(function(){$(".amount-discount").text(parseInt("0").format(0,3,".",","))}),$("#doku-voucher").change(function(){""!=$("option:selected",this).val()&&($(".amount-discount").text(parseInt($("option:selected",this).text()).format(0,3,".",",")),parseInt(a.req_amount)-parseInt($("option:selected",this).text())<0?$(".amount-total").text(0):$(".amount-total").text(parseInt(parseInt(a.req_amount)-parseInt($("option:selected",this).text())).format(0,3,".",",")))}),$("#voucher_check").change(function(){1==$(this).prop("checked")?""!=$("#doku-voucher :selected").val()&&($(".amount-discount").text(parseInt($("#doku-voucher :selected").text()).format(0,3,".",",")),$(".amount-total").text(parseInt(parseInt(a.req_amount)-parseInt($("#doku-voucher :selected").text())).format(0,3,".",","))):($(".amount-discount").text(parseInt("0").format(0,3,".",",")),$(".amount-total").text(parseInt(a.req_amount).format(0,3,".",",")))})}else $("#doku-voucher-div").remove(),$("#doku-voucher-value").remove(),$("#doku-total-payment").remove()}function formatWalletCc(a){var b=JSON.parse(a.res_data_dw);if(console.log(b),void 0==b.listPaymentChannel[1])$("#tablistItem2").remove(),$("#cc-tabs").remove();else if(void 0==b.listPaymentChannel[1].details)$("#frmcc").remove(),$(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC");else{$("#frmcc-manual").remove();var c="";for(i=0;i<b.listPaymentChannel[1].details.length;i++)0==i?(c=document.getElementById("listcard"+i).outerHTML,$("#r0").attr("checked",!0)):$("#listcard"+(i-1)).after(c.replace(new RegExp("0","g"),i)),"4"==b.listPaymentChannel[1].details[i].cardNoMasked.substring(0,1)?$("#type-cc"+i).addClass("visa"):"5"==b.listPaymentChannel[1].details[i].cardNoMasked.substring(0,1)&&$("#type-cc"+i).addClass("mastercard"),$("#doku-cc-number"+i).text(b.listPaymentChannel[1].details[i].cardNoMasked)}}function formatFormWallet(a){var b=$("#"+a[0].id+" :input").not("[type='button']").map(function(){return this.id}).get(),c=validateForm(b);if(c)if("frmcash"==a[0].id)a.req_pin=$("#"+b[b.length-1]).val(),submitFormWallet(a);else if("frmcc"==a[0].id)a.req_cvv=$("#"+b[b.length-1]).val(),a.req_cc_id=$("#"+a[0].id+" :input[type='radio']").map(function(){if(1==$(this).prop("checked"))return this.id}).get()[0],submitFormWallet(a);else{var d=$("#"+b[1]).val().split(" / ");2==d[1].length&&(d[1]="20"+d[1]),a.req_wallet_form={CC_NAME:$("#"+b[2]).val(),CC_CARDNUMBER:$("#"+b[0]).val().replace(/ - /g,""),CC_EXPIRYDATE:d[1].substring(2,4)+d[0],CC_MOBILEPHONE:$("#"+b[3]).val(),CC_EMAIL:$("#"+b[4]).val(),CC_CVV:$("#"+b[b.length-1]).val()},submitFormWallet(a)}}function submitFormWallet(a){var b=JSON.parse(a.res_data_dw),c=new Object;c.req_token_id=a.res_token_id,c.req_pairing_code=a.req_pairing_code,c.req_words=a.req_words,c.req_domain_valid=document.location.origin,"frmcash"==a[0].id?(c.req_dokuwallet={req_channel_code:b.listPaymentChannel[0].channelCode,req_customer_pin:a.req_pin,req_inquiry_code:b.inquiryCode,req_customer_name:b.customerName,req_customer_email:b.customerEmail,req_doku_id:b.dokuId},1==$("#voucher_check").prop("checked")&&""!=$("#doku-voucher :selected").val()&&(c.req_dokuwallet.req_promotion_id=$("#doku-voucher :selected").val())):"frmcc"==a[0].id?c.req_dokuwallet={req_channel_code:b.listPaymentChannel[1].channelCode,req_inquiry_code:b.inquiryCode,req_doku_id:b.dokuId,req_link_id:b.listPaymentChannel[1].details[a.req_cc_id.substring(1,2)].linkId,req_number:b.listPaymentChannel[1].details[a.req_cc_id.substring(1,2)].cardNoEncrypt,req_date:b.listPaymentChannel[1].details[a.req_cc_id.substring(1,2)].cardExpiryDateEncrypt,req_cvv:a.req_cvv}:(c.req_dokuwallet=a.req_wallet_form,c.req_dokuwallet.req_channel_code=b.listPaymentChannel[1].channelCode,c.req_dokuwallet.req_inquiry_code=b.inquiryCode,c.req_dokuwallet.req_doku_id=b.dokuId),console.log(c),$("[doku-div='form-payment']").html(a.req_loading),doku_timeout=setTimeout(function(){a.form_req_result_note="Timeout",showResult(a),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"PrePayment",data:{data:JSON.stringify(c)},dataType:"json",type:"POST"}).success(function(b){clearTimeout(doku_timeout),"0000"==b.res_response_code?void 0!=b.res_result_3D?(obj3D=JSON.parse(b.res_result_3D),window.addEventListener("message",receiveMessage,!1),$.fancybox.open([{closeClick:!1,type:"iframe",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:form3D,closeBtn:!1,autoResize:!0,helpers:{overlay:{closeClick:!1}},afterClose:function(){obj3dResponse=$.parseJSON(threeDResponse),"0000"==obj3dResponse.res_response_code?backToMerchant($.extend(a,$.extend(c,b))):(a.form_req_result_note=obj3dResponse.res_response_code,showResult(a))}}]),$("#doku-form-3d").find("#PaReq").val(obj3D.PAREQ),$("#doku-form-3d").find("#MD").val(obj3D.MD),$("#doku-form-3d").find("#TermUrl").val(obj3D.TERMURL),$("#doku-form-3d").attr("action",obj3D.ACSURL),$("#doku-form-3d").submit()):backToMerchant($.extend(a,$.extend(c,b))):(a.form_req_result_note=b.res_response_code,showResult(a))})}function showResult(a){console.log("showResult"),console.log(a),$("[doku-div='form-payment']").html(a.req_result),$(".fail").show(),$(".success").remove(),$("doku-approval-code").parent().parent().remove(),$("doku-card-number").parent().parent().remove(),$("doku-invoice-number").html(a.req_transaction_id),$("doku-amount").html(a.req_amount),$("doku-message").html("Error code : "+a.form_req_result_note.replace(new RegExp("_","g")," ")),$("div.detail-result").children("a").attr("href","#"),$("div.detail-result").children("a").html("Try Again"),a.retry=1,$("div.detail-result").children("a").attr("onclick","getForm("+JSON.stringify(a)+")")}function DokuToken(a){var b=new Object;if(void 0==data_obj.res_data_dw?b.responseCode="9999":b=$.parseJSON(data_obj.res_data_dw),"0000"==b.responseCode&&void 0!=data_obj.req_ref_account_id&&""!=data_obj.req_ref_account_id)processInlineForm(data_obj);else{if("15"==data_obj.req_payment_channel)var c=["doku-cc-exp","doku-cc-number","doku-name-cc","doku-cvc"];else if("04"==data_obj.req_payment_channel)var c=["doku-username","doku-password"];var d=validateFormInline(c);if(d){$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img src='"+loadingUrl+"' class='doku-loader-logo'><br><br><span class='doku-loader-text'>Please wait... your request is being processed</span></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}]);var e=formatFormInline();doku_timeout=setTimeout(function(){$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img width='10%' src='"+failedUrl+"' class='doku-failed-logo'><br><br><span class='doku-loader-text'>Request failed... Timeout</span><br><br><a href='#' class='doku-btn-retry' onclick='closePopup(); $(\"#"+c[0]+"\").focus();'>Try Again</a></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}]),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"getToken",data:{data:JSON.stringify(e)},dataType:"json",type:"POST"}).success(function(a){for(clearTimeout(doku_timeout),i=0;i<c.length;i++)$("#"+c[i]).val("");"0000"==a.res_response_code?processInlineForm(a):(console.log(a),$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img width='10%' src='"+failedUrl+"' class='doku-failed-logo'><br><br><span class='doku-loader-text'>Request failed... error code : "+a.res_response_code.replace(new RegExp("_","g")," ")+"</span><br><br><a href='#' class='doku-btn-retry' onclick='closePopup(); $(\"#"+c[0]+"\").focus();'>Try Again</a></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}]))})}}}function closePopup(){$.fancybox.close()}function validateFormInline(a){var b=!0;for(i=0;i<a.length;i++)if(void 0!=$("#"+a[i]).attr("validation-rules")){var c=$("#"+a[i]).attr("validation-rules").split("|"),d=new Object;for(j=0;j<c.length;j++){var d=checkRules(a[i],c[j]);if(0==d.status)break}0==d.status&&($("#"+a[i]).parent().addClass("has-error"),0==$("#"+a[i]).parent().children("font").length?$("#"+a[i]).parent().append("<font color='red'>"+d.msg+"</font>"):$("#"+a[i]).parent().children("font").html(d.msg),b=!1)}return b}function formatFormInline(){var a=new Object;if(a.req_merchant_code=data_obj.req_merchant_code,a.req_payment_channel=data_obj.req_payment_channel,a.req_transaction_id=data_obj.req_transaction_id,a.req_amount=data_obj.req_amount,a.req_currency=data_obj.req_currency,a.req_pairing_code=data_obj.res_request_code,a.req_access_type="W",a.req_domain_valid=document.location.origin,"15"==data_obj.req_payment_channel){if(void 0!=data_obj.req_customer_id&&""!=data_obj.req_customer_id){if(void 0==data_obj.res_tokenization){var b=$("#doku-cc-exp").val(),c=$("#doku-cc-number").val(),d=b.split(" / ");2==d[1].length&&(d[1]="20"+d[1]),a.req_date=d[1].substring(2,4)+d[0],a.req_number=c.replace(/ - /g,""),a.req_name=$("#doku-name-cc").val()}1==$("#doku-save-cc").prop("checked")?a.req_save_customer="SAVE":a.req_save_customer="UNSAVE"}else{var b=$("#doku-cc-exp").val(),c=$("#doku-cc-number").val(),d=b.split(" / ");2==d[1].length&&(d[1]="20"+d[1]),a.req_date=d[1].substring(2,4)+d[0],a.req_number=c.replace(/ - /g,""),a.req_name=$("#doku-name-cc").val()}a.req_secret=$("#doku-cvc").val()}else"04"==data_obj.req_payment_channel&&(a.req_doku_id=$("#doku-username").val(),a.req_doku_pass=$("#doku-password").val(),a.req_session_id=data_obj.req_session_id,a.req_chain_merchant=data_obj.req_chain_merchant);return a}function processInlineForm(a){if(console.log("processInlineForm"),console.log(a),"15"==data_obj.req_payment_channel)if(a.res_pairing_code=data_obj.res_request_code,a.res_invoice_no=data_obj.req_transaction_id,a.res_amount=data_obj.req_amount,a.res_chain_merchant=data_obj.req_chain_merchant,a.res_currency=data_obj.req_currency,a.res_mall_id=data_obj.req_merchant_code,$("#doku-cc-exp").val(""),$("#doku-cc-number").val(""),$("#doku-name-cc").val(""),$("#doku-cvc").val(""),void 0!=a.res_result_3D)obj3D=JSON.parse(a.res_result_3D),window.addEventListener("message",receiveMessage,!1),$.fancybox.open([{closeClick:!1,type:"iframe",content:form3D,closeBtn:!1,autoResize:!0,helpers:{overlay:{closeClick:!1}},afterClose:function(){obj3dResponse=$.parseJSON(threeDResponse),a=$.extend(a,obj3dResponse);var b=a;getToken(b)}}]),$("#doku-form-3d").find("#PaReq").val(obj3D.PAREQ),$("#doku-form-3d").find("#MD").val(obj3D.MD),$("#doku-form-3d").find("#TermUrl").val(obj3D.TERMURL),$("#doku-form-3d").attr("action",obj3D.ACSURL),$("#doku-form-3d").submit();else{var b=a;getToken(b)}else"04"==data_obj.req_payment_channel&&formatInlineFormDW(a)}function formatInlineFormDW(a){if("0000"==a.res_response_code){console.log($.parseJSON(a.res_data_dw)),$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",wrapCSS:"doku-wrap",content:a.res_form_payment_dw,helpers:{overlay:{closeClick:!1}}}]),$("#respTabs").responsiveTabs(),$(".resp-tabDrop").wrap("<div class='selectdw'><div class='wrapper-select'></div></div>"),$("input[name$='optdw']").click(function(){var a=$(this).val();$("div.promocontent-dw").hide(),$("#"+a).show()}),formatWalletCashInline(JSON.parse(a.res_data_dw)),formatWalletCcInline(JSON.parse(a.res_data_dw)),btnOnBlur();var b=$(".fancybox-wrap").find("input[type='button']").map(function(){return this.id}).get();for(i=0;i<b.length;i++)$("#"+b[i]).click(function(){formatFormWalletInline($.extend($(this).parents("form"),a))})}else{var c=a;getToken(c)}}function formatWalletCashInline(a){if($(".nameuser").text(a.customerName),$(".saldo").text(a.listPaymentChannel[0].details.lastBalance.format(0,3,".",",")),$(".amount-payment").text(parseInt(data_obj.req_amount).format(0,3,".",",")),$(".amount-discount").text(parseInt("0").format(0,3,".",",")),$(".amount-total").text(parseInt(data_obj.req_amount).format(0,3,".",",")),void 0!=a.listPromotion&&a.listPromotion.length>0){for(i=0;i<a.listPromotion.length;i++)$("#doku-voucher").append('<option value="'+a.listPromotion[i].id+'">'+a.listPromotion[i].amount+"</option>");$("#doku-voucher").change(function(){$(".amount-discount").text(parseInt("0").format(0))}),$("#doku-voucher").change(function(){""!=$("option:selected",this).val()&&($(".amount-discount").text(parseInt($("option:selected",this).text()).format(0,3,".",",")),parseInt(data_obj.req_amount)-parseInt($("option:selected",this).text())<0?$(".amount-total").text(0):$(".amount-total").text(parseInt(parseInt(data_obj.req_amount)-parseInt($("option:selected",this).text())).format(0,3,".",",")))}),$("#voucher_check").change(function(){1==$(this).prop("checked")?""!=$("#doku-voucher :selected").val()&&($(".amount-discount").text(parseInt($("#doku-voucher :selected").text()).format(0,3,".",",")),$(".amount-total").text(parseInt(parseInt(data_obj.req_amount)-parseInt($("#doku-voucher :selected").text())).format(0,3,".",","))):($(".amount-discount").text(parseInt("0").format(0,3,".",",")),$(".amount-total").text(parseInt(data_obj.req_amount).format(0,3,".",",")))})}else $("#doku-voucher-div").remove(),$("#doku-voucher-value").remove(),$("#doku-total-payment").remove()}function formatWalletCcInline(a){if(console.log(a),void 0==a.listPaymentChannel[1])$("#tablistItem2").remove(),$("#cc-tabs").remove();else if(void 0==a.listPaymentChannel[1].details)$("#frmcc").remove(),$(".doku-cc-number").payment("formatCardNumber"),$(".doku-cc-exp").payment("formatCardExpiry"),$(".doku-cvc").payment("formatCardCVC");else{$("#frmcc-manual").remove();var b="";for(i=0;i<a.listPaymentChannel[1].details.length;i++)0==i?(b=document.getElementById("listcard"+i).outerHTML,$("#r0").attr("checked",!0)):$("#listcard"+(i-1)).after(b.replace(new RegExp("0","g"),i)),"4"==a.listPaymentChannel[1].details[i].cardNoMasked.substring(0,1)?$("#type-cc"+i).addClass("visa"):"5"==a.listPaymentChannel[1].details[i].cardNoMasked.substring(0,1)&&$("#type-cc"+i).addClass("mastercard"),$("#doku-cc-number"+i).text(a.listPaymentChannel[1].details[i].cardNoMasked)}}function formatFormWalletInline(a){var b=$("#"+a[0].id+" :input").not("[type='button']").map(function(){return this.id}).get(),c=validateForm(b);if(console.log(c),c)if("frmcash"==a[0].id)a.req_pin=$("#"+b[b.length-1]).val(),submitFormWalletInline(a);else if("frmcc"==a[0].id)a.req_cvv=$("#"+b[b.length-1]).val(),a.req_cc_id=$("#"+a[0].id+" :input[type='radio']").map(function(){if(1==$(this).prop("checked"))return this.id}).get()[0],submitFormWalletInline(a);else{var d=$("#"+b[1]).val().split(" / ");2==d[1].length&&(d[1]="20"+d[1]),a.req_wallet_form={CC_NAME:$("#"+b[2]).val(),CC_CARDNUMBER:$("#"+b[0]).val().replace(/ - /g,""),CC_EXPIRYDATE:d[1].substring(2,4)+d[0],CC_MOBILEPHONE:$("#"+b[3]).val(),CC_EMAIL:$("#"+b[4]).val(),CC_CVV:$("#"+b[b.length-1]).val()},submitFormWalletInline(a)}}function submitFormWalletInline(a){var b=JSON.parse(a.res_data_dw),c=new Object;c.req_token_id=a.res_token_id,c.req_pairing_code=data_obj.res_request_code,c.req_words=data_obj.req_words,c.req_domain_valid=document.location.origin,"frmcash"==a[0].id?(c.req_dokuwallet={req_channel_code:b.listPaymentChannel[0].channelCode,req_customer_pin:a.req_pin,req_inquiry_code:b.inquiryCode,req_customer_name:b.customerName,req_customer_email:b.customerEmail,req_doku_id:b.dokuId},1==$("#voucher_check").prop("checked")&&""!=$("#doku-voucher :selected").val()&&(c.req_dokuwallet.req_promotion_id=$("#doku-voucher :selected").val())):"frmcc"==a[0].id?c.req_dokuwallet={req_channel_code:b.listPaymentChannel[1].channelCode,req_inquiry_code:b.inquiryCode,req_doku_id:b.dokuId,req_link_id:b.listPaymentChannel[1].details[a.req_cc_id.substring(1,2)].linkId,req_number:b.listPaymentChannel[1].details[a.req_cc_id.substring(1,2)].cardNoEncrypt,req_date:b.listPaymentChannel[1].details[a.req_cc_id.substring(1,2)].cardExpiryDateEncrypt,req_cvv:a.req_cvv}:(c.req_dokuwallet=a.req_wallet_form,c.req_dokuwallet.req_channel_code=b.listPaymentChannel[1].channelCode,c.req_dokuwallet.req_inquiry_code=b.inquiryCode,c.req_dokuwallet.req_doku_id=b.dokuId),console.log(c),doku_timeout=setTimeout(function(){$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img width='10%' src='"+failedUrl+"' class='doku-failed-logo'><br><br><span class='doku-loader-text'>Request failed... Timeout</span><br><br><a href='#' class='doku-btn-retry' onclick='closePopup();'>Try Again</a></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}]),doku_ajax.abort()},65e3),doku_ajax=$.ajax({url:requestURL+"PrePayment",data:{data:JSON.stringify(c)},dataType:"json",type:"POST",beforeSend:function(){$.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img src='"+loadingUrl+"' class='doku-loader-logo'><br><br><span class='doku-loader-text'>Please wait... your request is being processed</span></center>",
    closeBtn:!1,helpers:{overlay:{closeClick:!1}}}])}}).success(function(b){if(clearTimeout(doku_timeout),console.log("submitFormWalletInline"),console.log(b),"0000"==b.res_response_code)if(void 0!=b.res_result_3D)obj3D=JSON.parse(b.res_result_3D),window.addEventListener("message",receiveMessage,!1),$.fancybox.open([{closeClick:!1,type:"iframe",content:form3D,closeBtn:!1,autoResize:!0,helpers:{overlay:{closeClick:!1}},afterClose:function(){obj3dResponse=$.parseJSON(threeDResponse),b.res_token_id=a.res_token_id,b.res_pairing_code=data_obj.res_request_code,b.res_invoice_no=data_obj.req_transaction_id,b.res_amount=data_obj.req_amount,b.res_chain_merchant=data_obj.req_chain_merchant,b.res_currency=data_obj.req_currency,b.res_mall_id=data_obj.req_merchant_code,delete b.res_result_3D,obj=$.extend(b,obj3dResponse),console.log("prepayment 3d"),console.log(obj);var c=obj;getToken(c)}}]),$("#doku-form-3d").find("#PaReq").val(obj3D.PAREQ),$("#doku-form-3d").find("#MD").val(obj3D.MD),$("#doku-form-3d").find("#TermUrl").val(obj3D.TERMURL),$("#doku-form-3d").attr("action",obj3D.ACSURL),$("#doku-form-3d").submit();else{b.res_token_id=a.res_token_id,b.res_pairing_code=data_obj.res_request_code,b.res_invoice_no=data_obj.req_transaction_id,b.res_amount=data_obj.req_amount,b.res_chain_merchant=data_obj.req_chain_merchant,b.res_currency=data_obj.req_currency,b.res_mall_id=data_obj.req_merchant_code;var c=b;$.fancybox.close(),getToken(c)}else $.fancybox.open([{closeClick:!1,type:"html",openEffect:"fade",closeEffect:"fade",openSpeed:"slow",closeSpeed:"slow",content:"<center><br><img width='10%' src='"+failedUrl+"' class='doku-failed-logo'><br><br><span class='doku-loader-text'>Request failed... error code : "+b.res_response_code+"</span><br><br><a href='#' class='doku-btn-retry' onclick='closePopup();'>Try Again</a></center>",closeBtn:!1,helpers:{overlay:{closeClick:!1}}}])})}function dokuMandiriInitiate(a){$("#"+a.req_cc_field).focusout(function(){for(var b=$("#cc_number").val(),c="",d=!1,e=0;e<b.length;e++)b.charAt(e)>="0"&&b.charAt(e)<="9"&&(c+=b.charAt(e));for(var f=0,g=1;g<=c.length;g++){var h=c.charAt(c.length-g);if(g%2==0){var i=2*h;i>9?(f+=1,f+=i%10-0):f+=i-0}else f+=h-0}f%10||(d=!0),d&&($("#"+a.req_cc_field).removeClass("error"),$("#"+a.req_challenge_field).val($("#cc_number").val().replace(/ - /g,"").substr(6,16)))})}var $=jQuery.noConflict(),requestURL="https://staging.doku.com/api/payment/",originUrl="https://staging.doku.com",loadingUrl="https://staging.doku.com/doku-js/assets/images/loading.gif",failedUrl="https://staging.doku.com/doku-js/assets/images/failed.png",form3D='<form method="post" name="doku-form-3d" id="doku-form-3d" target=\'doku-iframe\'><input name="PaReq" type="hidden" id="PaReq"/><input name="MD" type="hidden" id="MD"/><input name="TermUrl" type="hidden" id="TermUrl"/>'+"</form><iframe name='doku-iframe' height='500' width='500'></iframe>",formDw='<div style="" class="dw-acc-exist"><div style="" class="ava-dw-exist"><img src="" alt="ava-image"></div><div style="" class="info-dw"><div class="info-dw-user" style=""></div><div class="info-dw-label" style="">Saldo saya</div><div class="info-dw-saldo" style="" class=""></div></div><div class="clear"></div></div>',threeDResponse,data_obj,doku_timeout,doku_ajax,frmSaveToken;Number.prototype.format=function(a,b,c,d){var e="\\d(?=(\\d{"+(b||3)+"})+"+(a>0?"\\D":"$")+")",f=this.toFixed(Math.max(0,~~a));return(d?f.replace(".",d):f).replace(new RegExp(e,"g"),"$&"+(c||","))},Object.size=function(a){var c,b=0;for(c in a)a.hasOwnProperty(c)&&b++;return b};var RespTabs={};!function(a){"use strict";a.fn.responsiveTabs=function(){return this.each(function(){var a=Object.create(RespTabs);a.init(this)})}}(jQuery),RespTabs.init=function(a){var b=$(a).children();$headers=b.children(":header"),$contents=b.children("div"),$headers.addClass("resp-headings"),$contents.addClass("resp-contents");var c=$('[resp-tab="default"]');c.length||(c=b.first()),c.children("div").addClass("resp-content__active").attr("aria-hidden","false"),$contents.not(".resp-content__active").hide().attr("aria-hidden","true"),c.children(":header").addClass("resp-heading__active");var d=$("<ul></ul>",{class:"resp-tablist"}),e=$("<select></select>",{class:"resp-tabDrop"}),f=1;$headers.each(function(){var a=$(this),c=$(this).next(),g=$("<option></option>",{class:"resp-tabDropOption",id:"tabOption"+f,text:a.text()}),h=$("<li></li>",{class:"resp-tablistItem",id:"tablistItem"+f,text:a.text(),click:function(){b.find(".resp-content__active").toggle().removeClass("resp-content__active").attr("aria-hidden","true").prev().removeClass("resp-heading__active"),c.toggle().addClass("resp-content__active").attr("aria-hidden","false"),a.addClass("resp-heading__active"),d.find(".resp-tablistItem__active").removeClass("resp-tablistItem__active"),h.addClass("resp-tablistItem__active"),$(".resp-tabDropOption").removeAttr("selected"),$(".resp-tabDropOption").eq($(".resp-tablistItem__active").index()).attr("selected","selected")}});c.hasClass("resp-content__active")&&h.addClass("resp-tablistItem__active"),d.append(h),e.append(g),e.change(function(){b.find(".resp-content__active").toggle().removeClass("resp-content__active").attr("aria-hidden","true").prev().removeClass("resp-heading__active"),$(".resp-contents").eq($(".resp-tabDrop :selected").index()).toggle().addClass("resp-content__active").attr("aria-hidden","false"),$(".resp-headings").eq($(".resp-tabDrop :selected").index()).addClass("resp-heading__active"),$(".resp-tablistItem").removeClass("resp-tablistItem__active"),$(".resp-tablistItem").eq($(".resp-tabDrop :selected").index()).addClass("resp-tablistItem__active")}),f++}),$(document).ready(function(){$(".resp-tabDropOption").eq(c.index()).attr("selected","selected")}),b.parent().before(d),b.parent().before(e)},function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=[].slice,z=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=window.jQuery||window.Zepto||window.$,a.payment={},a.payment.fn={},a.fn.payment=function(){var b,c;return c=arguments[0],b=2<=arguments.length?y.call(arguments,1):[],a.payment.fn[c].apply(this,b)},e=/(\d{1,4})/g,a.payment.cards=d=[{type:"visaelectron",patterns:[4026,417500,4405,4508,4844,4913,4917],format:e,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",patterns:[5018,502,503,56,58,639,6220,67],format:e,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:e,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:e,length:[16],cvcLength:[3],luhn:!0},{type:"visa",patterns:[4],format:e,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:e,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:e,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:e,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:e,length:[16],cvcLength:[3],luhn:!0}],b=function(a){var b,c,e,f,g,h,i,j;for(a=(a+"").replace(/\D/g,""),f=0,h=d.length;h>f;f++)for(b=d[f],j=b.patterns,g=0,i=j.length;i>g;g++)if(e=j[g],c=e+"",a.substr(0,c.length)===c)return b},c=function(a){var b,c,e;for(c=0,e=d.length;e>c;c++)if(b=d[c],b.type===a)return b},m=function(a){var b,c,d,e,f,g;for(d=!0,e=0,c=(a+"").split("").reverse(),f=0,g=c.length;g>f;f++)b=c[f],b=parseInt(b,10),(d=!d)&&(b*=2),b>9&&(b-=9),e+=b;return e%10===0},l=function(a){var b;return null!=a.prop("selectionStart")&&a.prop("selectionStart")!==a.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(b=document.selection)?b.createRange:void 0)||!document.selection.createRange().text)},w=function(a,b){var c,d,e;try{c=b.prop("selectionStart")}catch(a){d=a,c=null}return e=b.val(),b.val(a),null!==c&&b.is(":focus")?(c===e.length&&(c=a.length),b.prop("selectionStart",c),b.prop("selectionEnd",c)):void 0},r=function(a){var b,c,d,e,f,g,h,i;for(null==a&&(a=""),d="０１２３４５６７８９",e="0123456789",g="",b=a.split(""),h=0,i=b.length;i>h;h++)c=b[h],f=d.indexOf(c),f>-1&&(c=e[f]),g+=c;return g},q=function(b){return setTimeout(function(){var c,d;return c=a(b.currentTarget),d=c.val(),d=r(d),d=d.replace(/\D/g,""),w(d,c)})},o=function(b){return setTimeout(function(){var c,d;return c=a(b.currentTarget),d=c.val(),d=r(d),d=a.payment.formatCardNumber(d),w(d,c)})},h=function(c){var d,e,f,g,h,i,j;return f=String.fromCharCode(c.which),!/^\d+$/.test(f)||(d=a(c.currentTarget),j=d.val(),e=b(j+f),g=(j.replace(/\D/g,"")+f).length,i=16,e&&(i=e.length[e.length.length-1]),g>=i||null!=d.prop("selectionStart")&&d.prop("selectionStart")!==j.length)?void 0:(h=e&&"amex"===e.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,h.test(j)?(c.preventDefault(),setTimeout(function(){return d.val(j+" "+f)})):h.test(j+f)?(c.preventDefault(),setTimeout(function(){return d.val(j+f+" ")})):void 0)},f=function(b){var c,d;return c=a(b.currentTarget),d=c.val(),8!==b.which||null!=c.prop("selectionStart")&&c.prop("selectionStart")!==d.length?void 0:/\d\s$/.test(d)?(b.preventDefault(),setTimeout(function(){return c.val(d.replace(/\d\s$/,""))})):/\s\d?$/.test(d)?(b.preventDefault(),setTimeout(function(){return c.val(d.replace(/\d$/,""))})):void 0},p=function(b){return setTimeout(function(){var c,d;return c=a(b.currentTarget),d=c.val(),d=r(d),d=a.payment.formatExpiry(d),w(d,c)})},i=function(b){var c,d,e;return d=String.fromCharCode(b.which),/^\d+$/.test(d)?(c=a(b.currentTarget),e=c.val()+d,/^\d$/.test(e)&&"0"!==e&&"1"!==e?(b.preventDefault(),setTimeout(function(){return c.val("0"+e+" / ")})):/^\d\d$/.test(e)?(b.preventDefault(),setTimeout(function(){var a,b;return a=parseInt(e[0],10),b=parseInt(e[1],10),b>2&&0!==a?c.val("0"+a+" / "+b):c.val(""+e+" / ")})):void 0):void 0},j=function(b){var c,d,e;return d=String.fromCharCode(b.which),/^\d+$/.test(d)?(c=a(b.currentTarget),e=c.val(),/^\d\d$/.test(e)?c.val(""+e+" / "):void 0):void 0},k=function(b){var c,d,e;return e=String.fromCharCode(b.which),"/"===e||" "===e?(c=a(b.currentTarget),d=c.val(),/^\d$/.test(d)&&"0"!==d?c.val("0"+d+" / "):void 0):void 0},g=function(b){var c,d;return c=a(b.currentTarget),d=c.val(),8!==b.which||null!=c.prop("selectionStart")&&c.prop("selectionStart")!==d.length?void 0:/\d\s\/\s$/.test(d)?(b.preventDefault(),setTimeout(function(){return c.val(d.replace(/\d\s\/\s$/,""))})):void 0},n=function(b){return setTimeout(function(){var c,d;return c=a(b.currentTarget),d=c.val(),d=r(d),d=d.replace(/\D/g,"").slice(0,4),w(d,c)})},v=function(a){var b;return!(!a.metaKey&&!a.ctrlKey)||32!==a.which&&(0===a.which||(a.which<33||(b=String.fromCharCode(a.which),!!/[\d\s]/.test(b))))},t=function(c){var d,e,f,g;return d=a(c.currentTarget),f=String.fromCharCode(c.which),/^\d+$/.test(f)&&!l(d)?(g=(d.val()+f).replace(/\D/g,""),e=b(g),e?g.length<=e.length[e.length.length-1]:g.length<=16):void 0},u=function(b){var c,d,e;return c=a(b.currentTarget),d=String.fromCharCode(b.which),/^\d+$/.test(d)&&!l(c)?(e=c.val()+d,e=e.replace(/\D/g,""),!(e.length>6)&&void 0):void 0},s=function(b){var c,d,e;return c=a(b.currentTarget),d=String.fromCharCode(b.which),/^\d+$/.test(d)&&!l(c)?(e=c.val()+d,e.length<=4):void 0},x=function(b){var c,e,f,g,h;return c=a(b.currentTarget),h=c.val(),g=a.payment.cardType(h)||"unknown",c.hasClass(g)?void 0:(e=function(){var a,b,c;for(c=[],a=0,b=d.length;b>a;a++)f=d[a],c.push(f.type);return c}(),c.removeClass("unknown"),c.removeClass(e.join(" ")),c.addClass(g),c.toggleClass("identified","unknown"!==g),c.trigger("payment.cardType",g))},a.payment.fn.formatCardCVC=function(){return this.on("keypress",v),this.on("keypress",s),this.on("paste",n),this.on("change",n),this.on("input",n),this},a.payment.fn.formatCardExpiry=function(){return this.on("keypress",v),this.on("keypress",u),this.on("keypress",i),this.on("keypress",k),this.on("keypress",j),this.on("keydown",g),this.on("change",p),this.on("input",p),this},a.payment.fn.formatCardNumber=function(){return this.on("keypress",v),this.on("keypress",t),this.on("keypress",h),this.on("keydown",f),this.on("keyup",x),this.on("paste",o),this.on("change",o),this.on("input",o),this.on("input",x),this},a.payment.fn.restrictNumeric=function(){return this.on("keypress",v),this.on("paste",q),this.on("change",q),this.on("input",q),this},a.payment.fn.cardExpiryVal=function(){return a.payment.cardExpiryVal(a(this).val())},a.payment.cardExpiryVal=function(a){var b,c,d,e;return e=a.split(/[\s\/]+/,2),b=e[0],d=e[1],2===(null!=d?d.length:void 0)&&/^\d+$/.test(d)&&(c=(new Date).getFullYear(),c=c.toString().slice(0,2),d=c+d),b=parseInt(b,10),d=parseInt(d,10),{month:b,year:d}},a.payment.validateCardNumber=function(a){var c,d;return a=(a+"").replace(/\s+|-/g,""),!!/^\d+$/.test(a)&&(c=b(a),!!c&&(d=a.length,z.call(c.length,d)>=0&&(c.luhn===!1||m(a))))},a.payment.validateCardExpiry=function(b,c){var d,e,f;return"object"==typeof b&&"month"in b&&(f=b,b=f.month,c=f.year),!(!b||!c)&&(b=a.trim(b),c=a.trim(c),!!(/^\d+$/.test(b)&&/^\d+$/.test(c)&&b>=1&&12>=b)&&(2===c.length&&(c=70>c?"20"+c:"19"+c),4===c.length&&(e=new Date(c,b),d=new Date,e.setMonth(e.getMonth()-1),e.setMonth(e.getMonth()+1,1),e>d)))},a.payment.validateCardCVC=function(b,d){var e,f;return b=a.trim(b),!!/^\d+$/.test(b)&&(e=c(d),null!=e?(f=b.length,z.call(e.cvcLength,f)>=0):b.length>=3&&b.length<=4)},a.payment.cardType=function(a){var c;return a?(null!=(c=b(a))?c.type:void 0)||null:null},a.payment.formatCardNumber=function(c){var d,e,f,g;return c=c.replace(/\D/g,""),(d=b(c))?(f=d.length[d.length.length-1],c=c.slice(0,f),d.format.global?null!=(g=c.match(d.format))?g.join(" - "):void 0:(e=d.format.exec(c),null!=e?(e.shift(),e=a.grep(e,function(a){return a}),e.join(" - ")):void 0)):c},a.payment.formatExpiry=function(a){var b,c,d,e;return(c=a.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(b=c[1]||"",d=c[2]||"",e=c[3]||"",e.length>0?d=" / ":" /"===d?(b=b.substring(0,1),d=""):2===b.length||d.length>0?d=" / ":1===b.length&&"0"!==b&&"1"!==b&&(b="0"+b,d=" / "),b+d+e):""}}.call(this);